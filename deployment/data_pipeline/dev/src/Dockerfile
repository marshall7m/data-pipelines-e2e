FROM airflow_deps:latest-local-deps1

ARG DAGS_FOLDER
ENV DAGS_FOLDER=${DAGS_FOLDER}

COPY --chown=airflow:root dags/ $AIRFLOW_HOME/dags/

ARG PLUGINS_FOLDER
ENV PLUGINS_FOLDER=${PLUGINS_FOLDER}

COPY plugins/ $AIRFLOW_HOME/plugins/

ARG AIRFLOW_CONFIG
ENV AIRFLOW_CONFIG=${AIRFLOW_CONFIG}

COPY $AIRFLOW_CONFIG $AIRFLOW_HOME/cfg/airflow.cfg

ARG REQUIREMENTS_TXT=""
ENV REQUIREMENTS_TXT=${REQUIREMENTS_TXT}

ARG AIRFLOW_CONSTRAINTS_URL=""
ENV AIRFLOW_CONSTRAINTS_URL=${AIRFLOW_CONSTRAINTS_URL}

RUN if [ -n "${REQUIREMENTS_TXT}" ]; then pip install --user --upgrade pip && \
    pip install --user ${REQUIREMENTS_TXT} \
    --constraint "${AIRFLOW_CONSTRAINTS_URL} "; fi

